# Mutation Aggregator Configuration
# ==================================

# HTTP Client Settings
http_client:
  retries: 4                    # Nombre de tentatives en cas d'erreur
  backoff_factor: 0.7           # Facteur de délai entre les tentatives (exponentiel)
  connect_timeout: 10           # Timeout de connexion en secondes
  read_timeout: 30              # Timeout de lecture en secondes
  # Codes HTTP pour lesquels réessayer automatiquement
  # Note: 404 = ressource inexistante (normal si pas de données) - ne pas réessayer
  retry_status_codes:
    - 429   # Too Many Requests
    - 500   # Internal Server Error
    - 502   # Bad Gateway
    - 503   # Service Unavailable
    - 504   # Gateway Timeout
  rate_limits:                  # Requêtes par seconde par domaine
    rest.uniprot.org: 3
    eutils.ncbi.nlm.nih.gov: 3
    api.pharmgkb.org: 3

# Cache Settings
cache:
  path: "mutation_cache.sqlite3"
  timeout: 30                   # Durée de validité du cache en jours

# Output Settings
output:
  directory: "outputs"

# Sources Configuration
sources:
  # Option globale: récupère TOUS les variants disponibles (ignore les limites)
  # true = récupération complète (peut être lent pour certains gènes)
  # false = respecte les limites configurées dans 'limits'
  fetch_all: true
  
  # Activer/désactiver chaque source individuellement
  uniprot:
    enabled: true
  clinvar:
    enabled: true
  pharmgkb:
    enabled: true

# Correlation Settings
# Configuration pour la fusion des variants multi-sources
correlation:
  # Nombre minimum de critères communs pour fusionner deux records
  # 1 = fusion dès qu'un critère match (par défaut, sensible)
  # 2 = requiert au moins 2 critères communs (plus strict)
  # 3+ = très strict, moins de fusions
  min_criteria: 1
  
  # Critères de corrélation activés (ordre de priorité)
  # rsid: identifiant dbSNP (très fiable)
  # mut: mutation complète pos+ref+alt (très spécifique)
  # hgvs: notation cDNA c.XXX (fiable)
  # chr: position chromosomique chr:pos
  # pos: position AA seule (fallback, moins strict)
  enabled_keys:
    - rsid
    - mut
    - hgvs
    - chr
    - pos
  
  # Poids des critères de corrélation (plus élevé = plus fiable)
  # Utilisé pour déterminer la clé primaire lors des fusions
  key_weights:
    rsid: 5    # dbSNP ID - très fiable
    mut: 4     # Position + AA ref/alt - très spécifique
    hgvs: 3    # Notation cDNA - fiable
    chr: 2     # Position chromosomique - modéré
    pos: 1     # Position AA seule - fallback

# Splicing Analysis Settings
# Seuils pour classifier l'impact sur le splicing
splicing:
  # Distance (bp) pour splice site canonique (impact HIGH)
  canonical_threshold: 2
  # Distance (bp) pour splice site proche (impact MODERATE)  
  near_threshold: 10
  # Au-delà = deep intronic (impact LOW)

# PharmGKB Evidence Level Mapping
# Conversion des niveaux de preuve PharmGKB en catégories d'impact
pharmgkb:
  # Scores des niveaux de preuve (plus élevé = plus fort)
  level_scores:
    "1A": 5    # Guideline annotation + strong evidence
    "1B": 4    # Guideline annotation
    "2A": 3    # Known pharmacokinetic relationship
    "2B": 2    # Pharmacokinetic relationship likely
    "3": 1     # Annotation only
    "4": 0     # Case report
    "N/A": -1  # Non applicable
  # Seuils pour conversion en impact
  # >= high_threshold = HIGH, >= medium_threshold = MEDIUM, sinon LOW
  high_threshold: 4
  medium_threshold: 2

# Limits (ignorées si fetch_all=true pour la source correspondante)
# Ces limites permettent de contrôler le volume de données récupérées
# quand fetch_all=false, utile pour des tests rapides ou limiter les requêtes API
limits:
  max_workers: 10                        # Threads parallèles pour les requêtes API
  batch_size: 20                         # Taille des batches pour les requêtes API
  clinvar_max_records: 200               # Maximum de records ClinVar à traiter
  clinvar_search_limit: 200              # Limite retmax pour les recherches ClinVar
  pharmgkb_connected_variants: 20        # Limite variants connectés PharmGKB
  pharmgkb_clinical_annotations: 30      # Limite annotations cliniques PharmGKB
  pharmgkb_variant_annotations: 50       # Limite annotations de variants PharmGKB
  worker_timeout: 120                    # Timeout (s) pour chaque tâche d'API dans ThreadPoolExecutor (0=infini)
